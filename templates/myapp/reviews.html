{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'myapp/css/account.css' %}">
    <title>–û—Ç–∑—ã–≤—ã –Ω–∞ —Ñ–∏–ª—å–º—ã - DexterMorgan</title>
</head>
  <body>
    <header class="header">
      <div class="user-info">
        <span class="username">{{user.username}}</span>
      </div>
      <a href="{% url 'index' %}">–û —Å–µ–±–µ</a>
      <a href="{% url 'media' %}">–ú–µ–¥–∏–∞</a>
      <a href="{% url 'contacts' %}">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
      <a href="{% url 'reviews' %}">–û—Ç–∑—ã–≤—ã</a>
      <form method="post" action="{% url 'logout' %}">
        {% csrf_token %}
        <button class="logout-btn">–í—ã–π—Ç–∏</button>
      </form>
    </header>

    <div class="container">

        <div class="review-form-section">
            <h2>–ù–∞–ø–∏—Å–∞—Ç—å –Ω–æ–≤—ã–π –æ—Ç–∑—ã–≤</h2>
            <div class="form-group">
                <textarea 
                    id="review-text" 
                    rows="6"
                ></textarea>
                <div class="error-message" id="review-error"></div>
            </div>
            <button class="submit-btn" id="submit-review">
                <span class="btn-icon"></span> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤
            </button>
        </div>

        <div class="reviews-section">
            <div class="section-header">
                <h2>–í—Å–µ –æ—Ç–∑—ã–≤—ã</h2>
                <div class="legend">
                    <span class="legend-item">
                        <span class="legend-color positive"></span> –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π
                    </span>
                    <span class="legend-item">
                        <span class="legend-color negative"></span> –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π
                    </span>
                </div>
            </div>
            
            <div class="reviews-list" id="reviews-list">
                {% for review in all_reviews %}
                <div class="review-card {% if review.sentiment %}positive{% else %}negative{% endif %}" 
                     data-review-id="{{ review.id }}">
                    <div class="review-header">
                        <div class="review-author-block">
                            <span class="review-author"> {{ review.user.username }}</span>
                            <span class="review-date"> {{ review.created_at|date:"d.m.Y H:i" }}</span>
                        </div>
                        <span class="review-sentiment">
                            {% if review.sentiment %}
                                <span class="sentiment-badge positive-badge"> –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π</span>
                            {% else %}
                                <span class="sentiment-badge negative-badge"> –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π</span>
                            {% endif %}
                        </span>
                    </div>
                    <div class="review-text">{{ review.text }}</div>
                    {% if review.user == user or user.is_superuser %}
                    <button class="delete-btn" data-review-id="{{ review.id }}">
                         –£–¥–∞–ª–∏—Ç—å
                    </button>
                    {% endif %}
                </div>
                {% empty %}
                <div class="no-reviews">
                    <div class="no-reviews-icon">üé¨</div>
                    <p>–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <script>
        const csrfToken = "{{ csrf_token }}";
        const reviewsUrl = "{% url 'reviews' %}";
        const deleteUrl = "{% url 'delete_review' 0 %}".replace('0', '');
        const currentUsername = "{{ user.username }}";
    </script>
    <script src="{% static 'myapp/js/reviews.js' %}"></script>
</body>
</html>
