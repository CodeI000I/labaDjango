{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'myapp/css/reviews.css' %}">
    <title>–û—Ç–∑—ã–≤—ã –Ω–∞ —Ñ–∏–ª—å–º—ã - DexterMorgan</title>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">DexterMorgan</div>
            <nav class="nav">
                <a href="{% url 'index' %}" class="nav-link">–û —Å–µ–±–µ</a>
                <a href="{% url 'media' %}" class="nav-link">–ú–µ–¥–∏–∞</a>
                <a href="{% url 'contacts' %}" class="nav-link">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
                <a href="{% url 'reviews' %}" class="nav-link active">–û—Ç–∑—ã–≤—ã</a>
            </nav>
            <div class="user-info">
                <span class="username">{{ user.username }}</span>
                <form method="post" action="{% url 'logout' %}" style="display: inline;">
                    {% csrf_token %}
                    <button class="logout-btn">–í—ã–π—Ç–∏</button>
                </form>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="page-title">
            <h1>üé¨ –û—Ç–∑—ã–≤—ã –Ω–∞ —Ñ–∏–ª—å–º—ã</h1>
            <p class="subtitle">–î–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–∏–º –º–Ω–µ–Ω–∏–µ–º –æ —Ñ–∏–ª—å–º–∞—Ö, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –æ—Ç–∑—ã–≤–∞</p>
        </div>

        <div class="review-form-section">
            <h2>‚úçÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å –Ω–æ–≤—ã–π –æ—Ç–∑—ã–≤</h2>
            <p class="form-hint">–ù–∞–ø–∏—à–∏—Ç–µ –æ—Ç–∑—ã–≤ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ, –∏ –Ω–∞—à–∞ ML-–º–æ–¥–µ–ª—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç –µ–≥–æ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å</p>
            <div class="form-group">
                <label for="review-text">–í–∞—à –æ—Ç–∑—ã–≤:</label>
                <textarea 
                    id="review-text" 
                    placeholder="Write your movie review here in English... (minimum 10 characters)"
                    rows="6"
                ></textarea>
                <div class="char-counter">
                    <span id="char-count">0</span> —Å–∏–º–≤–æ–ª–æ–≤
                </div>
                <div class="error-message" id="review-error"></div>
            </div>
            <button class="submit-btn" id="submit-review">
                <span class="btn-icon">üì§</span> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤
            </button>
        </div>

        <div class="reviews-section">
            <div class="section-header">
                <h2>üìù –í—Å–µ –æ—Ç–∑—ã–≤—ã</h2>
                <div class="legend">
                    <span class="legend-item">
                        <span class="legend-color positive"></span> –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π
                    </span>
                    <span class="legend-item">
                        <span class="legend-color negative"></span> –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π
                    </span>
                </div>
            </div>
            
            <div class="reviews-list" id="reviews-list">
                {% for review in all_reviews %}
                <div class="review-card {% if review.sentiment %}positive{% else %}negative{% endif %}" 
                     data-review-id="{{ review.id }}">
                    <div class="review-header">
                        <div class="review-author-block">
                            <span class="review-author">üë§ {{ review.user.username }}</span>
                            <span class="review-date">üìÖ {{ review.created_at|date:"d.m.Y H:i" }}</span>
                        </div>
                        <span class="review-sentiment">
                            {% if review.sentiment %}
                                <span class="sentiment-badge positive-badge">üòä –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π</span>
                            {% else %}
                                <span class="sentiment-badge negative-badge">üòû –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π</span>
                            {% endif %}
                        </span>
                    </div>
                    <div class="review-text">{{ review.text }}</div>
                    {% if review.user == user or user.is_superuser %}
                    <button class="delete-btn" data-review-id="{{ review.id }}">
                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                    </button>
                    {% endif %}
                </div>
                {% empty %}
                <div class="no-reviews">
                    <div class="no-reviews-icon">üé¨</div>
                    <p>–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>&copy; 2025 DexterMorgan. –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—Ç–∑—ã–≤–æ–≤ —Å –ø–æ–º–æ—â—å—é ML</p>
    </footer>

    <script>
        const csrfToken = "{{ csrf_token }}";
        const reviewsUrl = "{% url 'reviews' %}";
        const deleteUrl = "{% url 'delete_review' 0 %}".replace('0', '');
        const currentUsername = "{{ user.username }}";
    </script>
    <script src="{% static 'myapp/js/reviews.js' %}"></script>
</body>
</html>
